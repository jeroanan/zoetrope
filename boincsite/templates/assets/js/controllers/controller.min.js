function getSortFunc(viewModel,sortFieldVar,reverseSortVar){function sortFunc(field){return viewModel[sortFieldVar]=field,field===currentSortField?void(viewModel[reverseSortVar]=!viewModel[reverseSortVar]):(currentSortField=field,viewModel[sortFieldVar]=field,void(viewModel[reverseSortVar]=!1))}var currentSortField=viewModel[sortFieldVar];return sortFunc}function getQueryStrings(){var assoc={},decode=function(s){return decodeURIComponent(s.replace(/\+/g," "))},queryString=location.search.substring(1),keyValues=queryString.split("&");for(var i in keyValues){var key=keyValues[i].split("=");key.length>1&&(assoc[decode(key[0])]=decode(key[1]))}return assoc}function DiskUsageController(diskUsageSvc){function load(){vm.ready=!1,vm.error=!1,diskUsageSvc.get()().query().$promise.then(gotDiskUsages,serviceError)}function gotDiskUsages(diskUsages){vm.disk_usages=diskUsages,vm.ready=!0}function serviceError(){vm.ready=!0,vm.error=!0}var vm=this;vm.orderProp="master_url",vm.reverseSort=!1,vm.ready=!1,vm.title="Disk Usage",vm.disk_usages={},vm.sort=getSortFunc(vm,"orderProp","reverseSort"),vm.upArrow=upArrow,vm.downArrow=downArrow,vm.error=!1,vm.load=load,document.title=vm.title,load()}function IndexController(tasksSvc,projectsSvc){function load(){vm.ready=!1,vm.error=!1,tasksSvc.get()().query().$promise.then(gotTasks,serviceError)}function gotTasks(tasks){vm.tasks=tasks,projectsSvc.get()().query().$promise.then(gotProjects,serviceError)}function serviceError(xhr){vm.error=!0,vm.ready=!0}function gotProjects(projects){function padTime(timeIn){var timeSplit=timeIn.split(":"),out="";for(var t in timeSplit)out+=1===timeSplit[t].length?"0"+timeSplit[t]:timeSplit[t],out+=":";return out.slice(0,out.length-1)}vm.projects=projects;var idx=0;vm.tasks=vm.tasks.map(function(x){return idx++,x.idx=idx,x.project_name=get_project_name(x,vm.projects),x.state=get_state_string(x),x.estimated_cpu_time_remaining=padTime(x.estimated_cpu_time_remaining),x.time_so_far=padTime(get_time_so_far(x)),x}),vm.ready=!0,vm.showRawData=!1,vm.title="BOINC Tasks",document.title=vm.title}var vm=this;vm.tasks={},vm.projects={},vm.sortProp="idx",vm.reverseSort=!1,vm.ready=!1,vm.sort=getSortFunc(vm,"sortProp","reverseSort"),vm.upArrow=upArrow,vm.downArrow=downArrow,vm.error=!1,vm.load=load,load()}function TaskController($http,$routeParams,taskSvc,projectsSvc){function load(){taskSvc.get()().query().$promise.then(gotTask,onError)}function abortButtonClicked(){vm.showConfirmAbort=!vm.showConfirmAbort}function onError(){vm.ready=!0,vm.error=!0}function gotTask(task){vm.task=task,projectsSvc.get()().query().$promise.then(gotProjects,onError)}function gotProjects(projects){vm.task.project_name=get_project_name(vm.task,projects),vm.task.state=get_state_string(vm.task),vm.task.time_so_far=get_time_so_far(vm.task),vm.suspend_button_text=vm.task.suspended_via_gui?"Resume":"Suspend",vm.ready=!0}var vm=this;vm.ready=!1,vm.title="Task Summary",vm.task={},vm.suspend_button_text="",vm.error="",vm.showConfirmAbort=!1,vm.abortButtonClicked=abortButtonClicked,vm.load=load,document.title=vm.title,load()}function ProjectsController(projectsSvc,updateProjectSvc){function load(){vm.ready=!1,vm.error=!1,projectsSvc.get()().query().$promise.then(gotProjects,serviceError)}function gotProjects(projects){vm.projects=projects.filter(function(x){return x.name.length>0}),vm.ready=!0}function serviceError(xhr){vm.error=!0,vm.ready=!0}function detachClicked(projectName,projectUrl){var dialog=$("#detachModal");vm.detachUrl=projectUrl,vm.detachName=projectName,dialog.modal("show")}function updateClicked(){updateProjectSvc.query(vm.project.master_url)().query()}var vm=this;vm.orderProp="name",vm.reverseSort=!1,vm.ready=!1,vm.showRawData=!1,vm.title="BOINC Projects",vm.detachClicked=detachClicked,vm.updateClicked=updateClicked,vm.detachUrl="",vm.detachName="",vm.sort=getSortFunc(vm,"orderProp","reverseSort"),vm.upArrow=upArrow,vm.downArrow=downArrow,vm.error=!1,vm.load=load,document.title=vm.title,load()}function ProjectController(projectSvc,updateProjectSvc,statisicsSvc,noMoreWorkSvc,allowMoreWorkSvc){function load(){vm.ready=!1,projectSvc().query().$promise.then(gotProject,serviceError)}function gotProject(project){vm.project=project,setTitle("Project Summary -- "+project.name),statisicsSvc.get(project.master_url)().query().$promise.then(gotStats,serviceError)}function gotStats(stats){var ps=[];for(var p in stats[0]){var o=stats[0][p];o.day&&ps.push(o)}vm.projectStats=ps.map(function(x){return x.user_total_credit=parseFloat(x.user_total_credit),x.user_expavg_credit=parseFloat(x.user_expavg_credit),x.host_total_credit=parseFloat(x.host_total_credit),x.host_expavg_credit=parseFloat(x.host_expavg_credit),x}),vm.projectFound=!0,vm.ready=!0}function serviceError(){vm.ready=!0,vm.projectFound=!1}function updateProjectClick(){vm.ready===!0&&updateProjectSvc.query(vm.project.master_url)().query()}function detachClicked(){$("#detachModal").modal("show")}function noMoreWorkClicked(){noMoreWorkSvc.query(vm.project.master_url)().query().$promise.then(function(){vm.project.dont_request_more_work=!0})}function resumeClicked(){allowMoreWorkSvc.query(vm.project.master_url)().query().$promise.then(function(){vm.project.dont_request_more_work=!1})}function setTitle(title){vm.title=title,document.title=vm.title}var vm=this;vm.ready=!1,vm.title="",vm.projectFound=!1,vm.project={},vm.projectStats=[],vm.statsSortField="day",vm.statsReverseSort=!0,vm.statsSort=getSortFunc(vm,"statsSortField","statsReverseSort"),vm.upArrow=upArrow,vm.downArrow=downArrow,vm.load=load,vm.updateProject=updateProjectClick,vm.detachClicked=detachClicked,vm.noMoreWorkClicked=noMoreWorkClicked,vm.resumeClicked=resumeClicked,document.title=vm.title,load()}function HostInfoController(hostInfoSvc){function load(){vm.ready=!1,vm.error=!1,hostInfoSvc.get()().query().$promise.then(gotHostInfo,serviceError)}function gotHostInfo(hostInfo){vm.host_info=hostInfo,vm.ready=!0}function serviceError(){vm.ready=!0,vm.error=!0}vm=this,vm.ready=!1,vm.title="Host Info",vm.host_info={},vm.error=!1,vm.load=load,document.title=vm.title,load()}function DailyTransferController(dailyTransferHistorySvc){function load(){vm.ready=!1,vm.error=!1,dailyTransferHistorySvc.get()().query().$promise.then(gotDailyTransfers,serviceError)}function gotDailyTransfers(dailyTransfers){function totalMegabytes(fieldName){var megs=dailyTransfers.map(function(x){return x[fieldName]}),total=megs.reduce(function(a,b){return a+b});return Math.round(100*total)/100}vm.daily_transfers=dailyTransfers.filter(function(transfer){return transfer.date}).map(function(transfer){var dateSplit=transfer.date.split("-"),theDate=new Date(dateSplit[0],dateSplit[1]-1,dateSplit[2]);return transfer.date=theDate,transfer}),vm.totalUploaded=totalMegabytes("uploaded")+"MB",vm.totalDownloaded=totalMegabytes("downloaded")+"MB",vm.ready=!0}function serviceError(){vm.ready=!0,vm.error=!0}var vm=this;vm.daily_transfers={},vm.totalUploaded="",vm.totalDownloaded="",vm.ready=!1,vm.title="Daily Transfer History",vm.orderProp="date",vm.reverseSort=!0,vm.sort=getSortFunc(vm,"orderProp","reverseSort"),vm.upArrow=upArrow,vm.downArrow=downArrow,vm.error=!1,vm.load=load,document.title=vm.title,load()}function MessagesController(messagesSvc){function load(){vm.ready=!1,vm.error=!1,messagesSvc.get()().query().$promise.then(gotMessages,serviceError)}function gotMessages(messages){function count_project_name(pn){var project_name_array=project_names.filter(function(el){return el==pn});return project_name_array.length}vm.messages=messages;var project_names=messages.map(function(x){return x.project_name});vm.unique_project_names=project_names.filter(function(el,i,a){return i==a.indexOf(el)});var tmp_name_counts={};for(var upn in vm.unique_project_names){var pn=vm.unique_project_names[upn];tmp_name_counts[pn]=count_project_name(pn)}vm.project_name_counts=tmp_name_counts,vm.ready=!0}function serviceError(){vm.ready=!0,vm.error=!0}function getProjectName(pn){return""===pn?"(no project)":pn}var vm=this;vm.orderProp="message_number",vm.reverseSort=!0,vm.filterProp="",vm.ready=!1,vm.title="Messages",document.title=vm.title,vm.messages={},vm.unique_project_names=[],vm.project_name_counts=[],vm.get_project_name=getProjectName,vm.sort=getSortFunc(vm,"orderProp","reverseSort"),vm.upArrow=upArrow,vm.downArrow=downArrow,vm.error=!1,vm.load=load,load()}function NoticesController(noticesSvc){function load(){vm.ready=!1,vm.error=!1,noticesSvc.get()().query().$promise.then(gotNotices,serviceError)}function gotNotices(notices){vm.notices=notices,vm.ready=!0}function serviceError(){vm.ready=!0,vm.error=!0}var vm=this;vm.notices=[],vm.title="Notices",vm.ready=!1,document.title=vm.title,vm.error=!1,vm.load=load,load()}function GlobalPreferencesCtrl(globalPreferencesSvc){function load(){vm.ready=!1,vm.error=!1,globalPreferencesSvc.get()().query().$promise.then(gotGlobalPreferences,serviceError)}function gotGlobalPreferences(preferences){vm.prefs=preferences,vm.ready=!0}function serviceError(){vm.ready=!0,vm.error=!0}var vm=this;vm.ready=!1,vm.title="Global Preferences",vm.prefs={},vm.error=!1,vm.load=load,document.title=vm.title,load()}function AllProjectListController(allProjectListSvc,projectsSvc,getPlatformSvc){function load(){vm.ready=!1,vm.error=!1,allProjectListSvc.get()().query().$promise.then(gotAllProjects,serviceError)}function gotAllProjects(projects){vm.allProjects=projects,projectsSvc.get()().query().$promise.then(gotAttachedProjects,serviceError),getPlatformSvc.get()().query().$promise.then(gotPlatform,serviceError)}function serviceError(){vm.ready=!0,vm.error=!0}function gotAttachedProjects(projects){vm.ready=!0,vm.availableProjects=vm.allProjects.map(function(x){var thisProject=projects.filter(function(y){return y.name==x.name});return x.attached=thisProject.length>0,x})}function gotPlatform(platform){var thisPlatform=platform.platform;vm.allProjects=vm.allProjects.map(function(x){var supportedPlatform=x.platforms.filter(function(y){return y.name===thisPlatform});return x.supported=supportedPlatform.length>0,x})}var vm=this;vm.ready=!1,vm.title="All Projects",vm.sortProp="name",vm.reverseSort=!1,vm.availableProjects=null,vm.doSort=getSortFunc(vm,"sortProp","reverseSort"),vm.allProjects=[],vm.upArrow=upArrow,vm.downArrow=downArrow,vm.load=load,document.title=vm.title,load()}function ProjectDetailController($routeParams,allProjectListSvc,projectsSvc){function load(){vm.ready=!1,vm.error=!1,allProjectListSvc.get()().query().$promise.then(gotAllProjects,serviceError)}function gotAllProjects(projects){return vm.project=projects.filter(function(x){return x.name===$routeParams.projectname})[0],vm.project?(projectsSvc.get()().query().$promise.then(gotAttachedProjects,serviceError),setTitle("Project Details -- "+vm.project.name),vm.projectFound=!0,void(vm.ready=!0)):(vm.projectFound=!1,void(vm.ready=!0))}function serviceError(){vm.ready=!0,vm.error=!0}function attachClicked(){$("#attachModal").modal("show")}function detachClicked(){$("#detachModal").modal("show")}function setTitle(title){vm.title=title,document.title=vm.title}function gotAttachedProjects(projects){var attachedProject=projects.filter(function(x){return x.name==vm.project.name});vm.project.attached=attachedProject.length>0}var vm=this;vm.ready=!1,vm.project={},vm.attachClicked=attachClicked,vm.detachClicked=detachClicked,vm.projectFound=!1,vm.error=!1,vm.load=load,setTitle("Project Details"),load()}function AttachProjectController(attachProjectSvc,allProjectListSvc,md5Svc){function gotProjects(projects){vm.attachedProjects=projects.filter(function(x){return x.name.length>0}),vm.ready=!0}function submitClicked(){if(vm.success=!1,vm.errorText="",""===vm.selectedProject||""===vm.emailaddress||""===vm.password)return vm.success=!1,void(vm.errorText="Please enter an email address, password and select a project to attach to.");var hash_in=vm.password+vm.emailaddress,password_hash=md5Svc.query(hash_in)();vm.loading=!0,attachProjectSvc.query(vm.selectedProject,vm.emailaddress,password_hash)().query().$promise.then(projectAttached)}function projectAttached(d){vm.loading=!1,vm.success=d.success,vm.errorText=d.error_message}function selectedProjectChanged(){vm.errorText=""}var vm=this;vm.selectedProject="",vm.emailaddress="",vm.password="",vm.submitClicked=submitClicked,vm.ready=!1,vm.title="Attach Project",vm.errorText="",vm.success=!1,vm.loading=!1,vm.selectedProjectChanged=selectedProjectChanged,allProjectListSvc.get()().query().$promise.then(gotProjects),document.title=vm.title}function DetachProjectController(projectsSvc,detachProjectSvc){function gotProjects(projects){vm.attachedProjects=projects.filter(function(x){return x.name.length>0}),vm.ready=!0}function confirmDetach(){return vm.selectedProject?void(vm.showConfirmDetach=!0):(vm.detachClicked=!0,vm.detachSuccessful=!1,void(vm.detachErrorMessage="Select a project to detach from first."))}function detachLinkClicked(){vm.detachClicked=!0,detachProjectSvc.query(vm.selectedProject)().query().$promise.then(projectDetached)}function projectDetached(d){vm.detachErrorMessage=d.error_message,vm.detachSuccessful=d.success}function selectedProjectChanged(){vm.detachErrorMessage="",vm.detachClicked=!1,vm.showConfirmDetach=!1}var vm=this;vm.attachedProjects=null,vm.ready=!1,vm.showConfirmDetach=!1,vm.selectedProject=null,vm.detachButtonClicked=confirmDetach,vm.detachLinkClicked=detachLinkClicked,vm.title="Detach Project",vm.detachSuccessful=!1,vm.detachClicked=!1,vm.detachErrorMessage="",vm.selectedProjectChanged=selectedProjectChanged,projectsSvc.get()().query().$promise.then(gotProjects),document.title=vm.title}angular.module("zoetropeControllers",["ngRoute","ngSanitize","zoetropeServices"]);var upArrow="&#x25B2;",downArrow="&#x25BC;",get_project_name=function(task,projects){for(var p in projects){var proj=projects[p];if(proj.master_url==task.project_url)return""===proj.name?task.project_url:proj.name}return task.project_url},get_time_so_far=function(task){return task.ready_to_report?task.final_cpu_time:task.current_cpu_time},get_state_string=function(task){if(task.suspended_via_gui)return"Task suspended by user";if(2===task.state&&(1===task.scheduler_state||0===task.active_task_state))return"Waiting to run";switch(task.state){case 2:return"Running";case 3:return"Computation error";case 5:return"Ready to report";case 6:return"Aborted by user";default:return task.state}};angular.module("zoetropeControllers").directive("keyvalrow",function(){return{restrict:"E",scope:{key:"@",val:"@"},templateUrl:"/static/directives/keyvalrow.html"}}),angular.module("zoetropeControllers").directive("keyvallinkrow",function(){return{restrict:"E",scope:{key:"@",link:"@",text:"@"},templateUrl:"/static/directives/keyvallinkrow.html"}}),angular.module("zoetropeControllers").directive("attachDialog",function(){return{restrict:"E",scope:{projecturl:"@",projectname:"@"},templateUrl:"/static/directives/attachDialog.html",controller:["$scope","attachProjectSvc","md5Svc",function($scope,attachProjectSvc,md5Svc){function submitClicked(){if($scope.errorText="",$scope.success=!1,""===$scope.password||""===$scope.emailaddress)return void($scope.errorText="Please enter an email address and password to attach to this project.");var hash_in=$scope.password+$scope.emailaddress,password_hash=md5Svc.query(hash_in)();$scope.loading=!0,attachProjectSvc.query($scope.projecturl,$scope.emailaddress,password_hash)().query().$promise.then(function(d){$scope.loading=!1,d.error_message&&""!==d.error_message?$scope.errorText=d.error_message:$scope.success=!0})}$scope.emailaddress="",$scope.password="",$scope.submitClicked=submitClicked,$scope.errorText="",$scope.success=!1,$scope.loading=!1}],link:function(scope,element,attrs,ctrl){}}}),angular.module("zoetropeControllers").directive("detachDialog",function(){return{restrict:"E",templateUrl:"/static/directives/detachDialog.html",controller:["$scope","detachProjectSvc",function($scope,detachProjectSvc){function submitClicked(){$scope.errorText="",detachProjectSvc.query($scope.projecturl)().query().$promise.then(function(d){d.error_message?$scope.errorText=d.error_message:$("#detachModal").modal("hide")})}$scope.submitClicked=submitClicked,$scope.errorText="",$scope.projecturl="",$scope.projectname=""}],link:function(scope,element,attrs,ctrl){attrs.$observe("projecturl",function(val){scope.projecturl=val}),attrs.$observe("projectname",function(val){scope.projectname=val})}}}),angular.module("zoetropeControllers").controller("DiskUsageCtrl",DiskUsageController),DiskUsageController.$inject=["diskUsageSvc"],angular.module("zoetropeControllers").controller("IndexCtrl",IndexController),IndexController.$inject=["tasksSvc","projectsSvc"],angular.module("zoetropeControllers").controller("TaskCtrl",TaskController),TaskController.$inject=["$http","$routeParams","taskSvc","projectsSvc"],angular.module("zoetropeControllers").controller("ProjectsCtrl",ProjectsController),ProjectsController.$inject=["projectsSvc","updateProjectSvc"],angular.module("zoetropeControllers").controller("ProjectCtrl",ProjectController),ProjectController.$inject=["projectSvc","updateProjectSvc","statisicsSvc","noMoreWorkSvc","allowMoreWorkSvc"],angular.module("zoetropeControllers").controller("HostInfoCtrl",HostInfoController),HostInfoController.$inject=["hostInfoSvc"],angular.module("zoetropeControllers").controller("DailyTransferCtrl",DailyTransferController),DailyTransferController.$inject=["dailyTransferHistorySvc"],angular.module("zoetropeControllers").controller("MessagesCtrl",MessagesController),MessagesController.$inject=["messagesSvc"],angular.module("zoetropeControllers").controller("NoticesCtrl",NoticesController),NoticesController.$inject=["noticesSvc"],angular.module("zoetropeControllers").controller("globalPreferencesCtrl",GlobalPreferencesCtrl),GlobalPreferencesCtrl.$inject=["globalPreferencesSvc"],angular.module("zoetropeControllers").controller("allProjectListCtrl",AllProjectListController),AllProjectListController.$inject=["allProjectListSvc","projectsSvc","getPlatformSvc"],angular.module("zoetropeControllers").controller("projectDetailCrl",ProjectDetailController),ProjectDetailController.$inject=["$routeParams","allProjectListSvc","projectsSvc"],angular.module("zoetropeControllers").controller("attachProjectCtrl",AttachProjectController),AttachProjectController.$inject=["attachProjectSvc","allProjectListSvc","md5Svc"],angular.module("zoetropeControllers").controller("detachProjectCtrl",DetachProjectController),DetachProjectController.$inject=["projectsSvc","detachProjectSvc"];
//# sourceMappingURL=controller.js.map