function addUserController(a,b){function c(){function a(a){a.logged_in||(document.location="/#/login")}function c(a){document.location="/#/login"}b.getStatus(a,c)}function d(){return e.errorText="",e.operationSuccess=null,""===e.userId||""===e.password?(e.operationSuccess=!1,void(e.errorText="Please enter a username and a password")):e.userId.contains("|")?(e.operationSuccess=!1,void(e.errorText="User names cannot contain the pipe (|) characer")):e.password!==e.confirmPassword?(e.operationSuccess=!1,void(e.errorText="Password and Confirm Password must match.")):void a.addUser(e.userId,e.password,function(a){return!a.success&&a.error_message?(e.operationSuccess=!1,void(e.errorText=a.error_message)):void(e.operationSuccess=!0)},function(a){e.operationSuccess=!1,e.errorText=a.statusText})}var e=this;e.title="Add User",e.ready=!0,e.errorText="",e.operationSuccess=null,e.operationSuccessMessage="User added successfully",e.userId="",e.password="",e.confirmPassword="",e.submitClicked=d,document.title=e.title,c()}function AllProjectListController(a,b,c,d){function e(){j.ready=!1,j.error=!1,c.getAvailableProjects(f,g)}function f(a){return a.length>0&&a[0].error_message&&a[0].error_message===-1414?void b.path("/#/login"):(j.allProjects=a,c.getAttachedProjects(h,g),void d.getPlatform(i,g))}function g(){j.ready=!0,j.error=!0}function h(a){return j.ready=!0,a.length>0&&a[0].error_message&&a[0].error_message===-1414?void b.path("/#/login"):void(j.availableProjects=j.allProjects.map(function(b){var c=a.filter(function(a){return a.project_name==b.name});return b.attached=c.length>0,b}))}function i(a){var b=a.platform;j.allProjects=j.allProjects.map(function(a){var c=a.platforms.filter(function(a){return a.name===b});return a.supported=c.length>0,a})}var j=this;j.ready=!1,j.error=!1,j.title="All Projects",j.sortProp="name",j.reverseSort=!1,j.availableProjects=null,j.allProjects=[],j.sort=getSortFunc(j,"sortProp","reverseSort"),j.load=e,a[0].title=j.title,e()}function AttachProjectController(a,b,c){function d(a){a.length>0&&!g(a[0])||(i.attachedProjects=a.filter(function(a){return a.name.length>0}),i.ready=!0)}function e(){if(i.success=!1,i.errorText="",""===i.selectedProject||""===i.emailaddress||""===i.password)return i.success=!1,void(i.errorText="Please enter an email address, password and select a project to attach to.");var a=i.password+i.emailaddress,d=c.query(a);i.loading=!0,b.attachProject(i.selectedProject,i.emailaddress,d,"",!1,f)}function f(a){g(a)&&(i.loading=!1,i.success=a.success,i.errorText=a.error_message)}function g(b){return!b.error_message||b.error_message!==-1414||(a.path("/#/login"),!1)}function h(){i.errorText=""}var i=this;i.selectedProject="",i.emailaddress="",i.password="",i.ready=!1,i.title="Attach Project",i.errorText="",i.success=!1,i.loading=!1,i.submitClicked=e,i.selectedProjectChanged=h,b.getAvailableProjects(d),document.title=i.title}function getSortFunc(a,b,c){function d(d){return a[b]=d,d===e?void(a[c]=!a[c]):(e=d,a[b]=d,void(a[c]=!1))}var e=a[b];return d}function DailyTransferController(a){function b(){e.ready=!1,e.error=!1,a.getDailyTransferHistory(c,d)}function c(a){function b(b){var c=a.map(function(a){return a[b]}),d=c.reduce(function(a,b){return a+b});return Math.round(100*d)/100}return a.length>0&&a[0].error_message&&a[0].error_message===-1414?void(document.location="/#/login"):(e.daily_transfers=a.filter(function(a){return a.when}).map(function(a){var b=a.when.split("-"),c=new Date(b[0],b[1]-1,b[2]);return a.when=c,a}),e.totalUploaded=b("up")+"MB",e.totalDownloaded=b("down")+"MB",void(e.ready=!0))}function d(){e.ready=!0,e.error=!0}var e=this;e.daily_transfers={},e.totalUploaded="",e.totalDownloaded="",e.ready=!1,e.title="Daily Transfer History",e.sortProp="when",e.reverseSort=!0,e.sort=getSortFunc(e,"sortProp","reverseSort"),e.error=!1,e.load=b,document.title=e.title,b()}function DetachProjectController(a,b,c){function d(a){return a.length>0&&a[0].error_message&&a[0].error_message===-1414?void c.path("/#/login"):(i.attachedProjects=a.filter(function(a){return a.project_name.length>0}),void(i.ready=!0))}function e(){return i.selectedProject?void(i.showConfirmDetach=!0):(i.detachClicked=!0,i.detachSuccessful=!1,void(i.detachErrorMessage="Select a project to detach from first."))}function f(){i.detachClicked=!0,a.detachProject(i.selectedProject,g)}function g(a){return a.error_message===-1414?void c.path("/#/login"):(i.detachErrorMessage=a.error_message,void(i.detachSuccessful=a.success))}function h(){i.detachErrorMessage="",i.detachClicked=!1,i.showConfirmDetach=!1}var i=this;i.attachedProjects=null,i.ready=!1,i.showConfirmDetach=!1,i.selectedProject=null,i.title="Detach Project",i.detachSuccessful=!1,i.detachClicked=!1,i.detachErrorMessage="",i.detachButtonClicked=e,i.detachLinkClicked=f,i.selectedProjectChanged=h,a.getAttachedProjects(d),b[0].title=i.title}function DiskUsageController(a){function b(){e.ready=!1,e.error=!1,a.getDiskUsage(c,d)}function c(a){return a.error_message&&a.error_message===-1414?void(document.location="/#/login"):(e.disk_usages=a,void(e.ready=!0))}function d(){e.ready=!0,e.error=!0}var e=this;e.sortProp="master_url",e.reverseSort=!1,e.ready=!1,e.title="Disk Usage",e.disk_usages={},e.sort=getSortFunc(e,"sortProp","reverseSort"),e.error=!1,e.load=b,document.title=e.title,b()}function GlobalPreferencesCtrl(a){function b(){e.ready=!1,e.error=!1,a.getGlobalPreferences(c,d)}function c(a){return a.error_message&&a.error_message===-1414?void(document.location="/#/login"):(e.prefs=a,void(e.ready=!0))}function d(){e.ready=!0,e.error=!0}var e=this;e.ready=!1,e.title="Global Preferences",e.prefs={},e.error=!1,e.load=b,document.title=e.title,b()}function HostInfoController(a){function b(){vm.ready=!1,vm.error=!1,a.getHostInfo(c,d)}function c(a){return a.error_message&&a.error_message===-1414?void(document.location="/#/login"):(a.uptime=a.uptime.split(".")[0],vm.host_info=a,void(vm.ready=!0))}function d(){vm.ready=!0,vm.error=!0}vm=this,vm.ready=!1,vm.title="Host Info",vm.host_info={},vm.error=!1,vm.load=b,document.title=vm.title,b()}function IndexController(a,b){function c(){function c(b){a.logged_in=b.logged_in}function d(){}b.getStatus(c,d)}loggedIn=!1,c()}function LoginController(a){function b(){return e.operationSuccess=!1,e.operationSuccessMessage="",e.errorText="",""===e.username||""===e.password?(e.operationSuccess=!1,void(e.errorText="Please enter a username and password")):void a.login(e.username,e.password,c,d)}function c(a){return a.success?(e.operationSuccess=!0,e.operationSuccessMessage="Login successful",void setTimeout(function(){document.location="/"},2e3)):(e.operationSuccess=!1,void(e.errorText=a.error_message))}function d(a){e.operationSuccess=!1,e.errorText=a.statusText}var e=this;e.username="",e.password="",e.title="Login",e.operationSuccess=!1,e.errorText="",e.loginClicked=b,$("input[name=username]").focus(),document.title=e.title}function ManageUsersController(a){function b(){a.getUsers(c)}function c(a){return a.length>0&&a[0].error_message&&a[0].error_message===-1414?void(document.location="/#/login"):(i.users=a,void(i.ready=!0))}function d(a,b){i.userOperationUser={userId:a.user_id,userNo:a.user_no,rowNo:b},$("#deleteUserModal").modal("show")}function e(){i.operationSuccess=!1,i.operationSuccessMessage="",$("#deleteUserModal").modal("hide"),a.deleteUser(i.userOperationUser,f)}function f(a){if(!a.success&&a.error_message)return i.operationSuccess=!1,void(i.errorText=a.error_message);var b=a.error_message.split("|"),c=b[1],d=b[2];i.operationSuccess=!0,i.operationSuccessMessage="User "+c+" deleted successfully",$("#userRow-"+d).parents("tr").hide()}function g(){$("#addUserModal").modal("show")}function h(a,b){i.userOperationUser={userId:a.user_id,userNo:a.user_no,rowNo:b},$("#changePasswordModal").modal("show")}var i=this;i.title="Manage Users",i.ready=!1,i.sortProp="user_id",i.reverseSort=!1,i.sort=getSortFunc(i,"sortProp","reverseSort"),i.users=[],i.userOperationUser=null,i.operationSuccess=!1,i.operationSuccessMessage="",i.errorText="",i.deleteClicked=d,i.addUserClicked=g,i.changePasswordClicked=h,i.doDelete=e,i.load=b,document.title=i.title,b()}function MessagesController(a){function b(){f.ready=!1,f.error=!1,a.getMessages(c,d)}function c(a){function b(a){var b=c.filter(function(b){return b==a});return b.length}if(a.length>0&&a[0].error_message&&a[0].error_message===-1414)return void(document.location="/#/login");f.messages=a;var c=a.map(function(a){return a.project_name}),d=c.filter(function(a,b,c){return b==c.indexOf(a)}),e={};for(var g in d){var h=d[g];e[h]=b(h)}f.project_name_counts=e,f.ready=!0}function d(){f.ready=!0,f.error=!0}function e(a){return""===a?"(No project)":a}var f=this;f.sortProp="seqno",f.reverseSort=!0,f.filterProp="",f.ready=!1,f.title="Messages",f.messages={},f.project_name_counts=[],f.get_project_name=e,f.sort=getSortFunc(f,"sortProp","reverseSort"),f.error=!1,f.load=b,document.title=f.title,b()}function MiscConfigController(a,b){function c(){b.set(d.endpoint)}var d=this;d.ready=!0,d.title="Misc Config",document.title=d.title,d.submitClicked=c,d.endpoint=b.get()}function NoticesController(a){function b(){e.ready=!1,e.error=!1,a.getNotices(c,d)}function c(a){return a.length>0&&a[0].error_message&&a[0].error_message===-1414?void(document.location="/#/login"):(e.notices=a,void(e.ready=!0))}function d(){e.ready=!0,e.error=!0}var e=this;e.notices=[],e.title="Notices",e.ready=!1,document.title=e.title,e.error=!1,e.load=b,b()}function ProjectController(a,b,c,d,e,f){function g(){s.ready=!1,f.getProject(a.project,h,i)}function h(a){return a.error_message&&a.error_message===-1414?void e.path("/#/login"):(s.project=a,r("Project Summary -- "+a.project_name),$("#statsRow").append(b('<project-statistics project-url="'+a.master_url+'" />')(c)),s.projectFound=!0,void(s.ready=!0))}function i(){s.ready=!0,s.projectFound=!1}function j(){s.ready===!0&&f.updateProject(s.project.master_url)}function k(){$("#detachModal").modal("show")}function l(){f.noMoreWork(s.project.master_url,function(){s.project.dont_request_more_work=!0})}function m(){f.allowMoreWork(s.project.master_url,function(){s.project.dont_request_more_work=!1})}function n(){f.suspendProject(s.project.master_url,function(){s.project.suspended_via_gui=!0})}function o(){f.resumeProject(s.project.master_url,function(){s.project.suspended_via_gui=!1})}function p(){f.detachWhenDone(s.project.master_url)}function q(){f.dontDetachWhenDone(s.project.master_url)}function r(a){s.title=a,d[0].title=s.title}var s=this;s.ready=!1,s.title="",s.projectFound=!1,s.project={},s.upArrow=upArrow,s.downArrow=downArrow,s.load=g,s.updateProject=j,s.detachClicked=k,s.noMoreWorkClicked=l,s.allowMoreWorkClicked=m,s.suspendClicked=n,s.resumeClicked=o,s.detachWhenDoneClicked=p,s.dontDetachWhenDoneClicked=q,d[0].title=s.title,g()}function ProjectDetailController(a,b,c,d,e){function f(){n.ready=!1,n.error=!1,d.getAvailableProjects(g,h)}function g(b){return b.length>0&&b[0].error_message&&b[0].error_message===-1414?void c.path("/#/login"):(n.project=b.filter(function(b){return b.name===a.projectname})[0],n.project?(d.getAttachedProjects(l,h),e.getPlatform(m,h),k("Project Details -- "+n.project.name),n.projectFound=!0,void(n.ready=!0)):(n.projectFound=!1,void(n.ready=!0)))}function h(){n.ready=!0,n.error=!0}function i(){$("#attachModal").modal("show")}function j(){$("#detachModal").modal("show")}function k(a){n.title=a,b[0].title=n.title}function l(a){var b=a.filter(function(a){return a.project_name===n.project.name});n.project.attached=b.length>0}function m(a){var b=n.project.platforms.filter(function(b){return b.name===a.platform});n.project.platformSupported=b.length>0,n.gotPlatform=!0;for(var c=$("#supportedPlatforms").children("li:contains("+a.platform+")"),d=0;d<c.length;d++){var e=$(c[d]);e.addClass("text-success"),e.text(e.text()+" ✔")}}var n=this;n.ready=!1,n.project={},n.projectFound=!1,n.error=!1,n.gotPlatform=!1,n.load=f,n.attachClicked=i,n.detachClicked=j,k("Project Details"),f()}function ProjectsController(a,b,c){function d(){l.ready=!1,l.error=!1,a.getAttachedProjects(e,f)}function e(a){if(a.length>0){var b=a[0];if(b.error_message&&b.error_message===-1414)return void c.path("/#/login")}l.projects=a.filter(function(a){return a.project_name.length>0}),l.ready=!0}function f(a){l.error=!0,l.ready=!0}function g(a,b){var c=$("#detachModal");l.detachUrl=b,l.detachName=a,c.modal("show")}function h(b,c,d,e){return function(f){i(),a[b](f,function(){j(c),d&&d&&k(f,d,e)})}}function i(){l.operationSuccess=!1,l.operationSuccessMessage=""}function j(a){l.operationSuccess=!0,l.operationSuccessMessage=a}function k(a,b,c){l.projects=l.projects.map(function(d){return d.master_url!==a?d:(d[b]=c,d)})}var l=this;l.sortProp="name",l.reverseSort=!1,l.ready=!1,l.showRawData=!1,l.title="BOINC Projects",l.detachUrl="",l.detachName="",l.error=!1,l.operationSuccess=!1,l.operationSuccessMessage="",l.load=d,l.sort=getSortFunc(l,"sortProp","reverseSort"),l.detachClicked=g,l.updateClicked=h("updateProject","Project updated successfully"),l.noMoreWorkClicked=h("noMoreWork","New tasks disallowed","dont_request_more_work",!0),l.allowMoreWorkClicked=h("allowMoreWork","New tasks re-allowed","dont_request_more_work",!1),l.suspendProjectClicked=h("suspendProject","Project suspended","suspended_via_gui",!0),l.resumeProjectClicked=h("resumeProject","Project resumed","suspended_via_gui",!1),b[0].title=l.title,d()}function TaskController(a,b,c,d,e){function f(){d.getTask(a.task_name,l,k)}function g(){p.showConfirmAbort=!p.showConfirmAbort}function h(a,b,c,e){return function(){i(),d[a](p.task.name,function(){j(b),c&&c&&(p.task[c]=e)})}}function i(){p.operationSuccess=!1,p.operationSuccessMessage=""}function j(a){p.operationSuccess=!0,p.operationSuccessMessage=a}function k(){p.ready=!0,p.error=!0}function l(a){if(a.error_message&&a.error_message===-1414)return void c.path("/#/login");a.truncatedName=a.name.substr(0,20),a.name.length>20&&(a.truncatedName+="..."),a.displayName=a.truncatedName,a.active_task_state=0===a.active_task_state?"Inactive":"Active";var b=!1,d=!1,f=a.report_deadline.split(" ")[0].split("-");if(3===f.length){var g=new Date(f[0],f[1]-1,f[2]),h=new Date;if(h>g)b=!0;else{var i=864e5,j=2,l=g-h;d=l<i*j}}a.overdue=b,a.deadlineApproaching=d,p.task=a,e.getAttachedProjects(m,k)}function m(a){p.task.project_name=get_project_name(p.task,a),p.task.state=get_state_string(p.task),p.task.time_so_far=get_time_so_far(p.task),p.ready=!0}function n(a){return a.overdue?"text-danger":a.deadlineApproaching?"text-warning":void 0}function o(){return p.task.displayName===p.task.name?void(p.task.displayName=p.task.truncatedName):void(p.task.displayName=p.task.name)}var p=this;p.ready=!1,p.title="Task Summary",p.task={},p.error="",p.showConfirmAbort=!1,p.operationSuccess=!1,p.operationSuccessMessage="",p.load=f,p.getDeadlineClass=n,p.taskNameClicked=o,p.suspendClicked=h("suspendTask","Task suspended","suspended_via_gui",!0),p.resumeClicked=h("resumeTask","Task resumed","suspended_via_gui",!1),p.abortTaskLinkClicked=h("abortTask","Task Aborted"),p.abortButtonClicked=g,b[0].title=p.title,f()}function TasksController(a,b,c,d,e,f){function g(){o.ready=!1,o.error=!1,e.getAllTasks(h,i)}function h(a){if(a.length>0){var b=a[0];if(!b.success&&b.error_message==-1414)return void(document.location="/#/login");f.getAttachedProjects(k,j),o.ready=!0,o.tasks=a}}function i(){c.error("tasksCtrl: Error while getting tasks."),j()}function j(){o.error=!0,o.ready=!0}function k(a){o.projects=a,m()}function l(a){var b=a.toString().split(":"),c="";for(var d in b)c+=1===b[d].length?"0"+b[d]:b[d],c+=":";return c.slice(0,c.length-1)}function m(){var a=0;o.tasks=o.tasks.map(function(b){a++,b.idx=a,b.project_name=get_project_name(b,o.projects),b.state=get_state_string(b),b.estimated_cpu_time_remaining=l(b.estimated_cpu_time_remaining),b.time_so_far=l(get_time_so_far(b));var c=!1,d=!1,e=b.report_deadline.toString().split(" ")[0].split("-");if(3===e.length){var f=new Date(e[0],e[1]-1,e[2]),g=new Date;if(g>f)c=!0;else{var h=864e5,i=2,j=f-g;d=j<h*i}}return b.overdue=c,b.deadlineApproaching=d,b}),o.ready=!0}function n(a){return a.overdue?"text-danger":a.deadlineApproaching?"text-warning":void 0}var o=this;o.tasks={},o.projects={},o.sortProp="idx",o.reverseSort=!1,o.ready=!1,o.error=!1,o.showRawData=!1,o.title="BOINC Tasks",a[0].title=o.title,o.load=g,o.getDeadlineClass=n,o.sort=getSortFunc(o,"sortProp","reverseSort"),g()}angular.module("zoetropeControllers").controller("addUserCtrl",addUserController),addUserController.$inject=["userSvc","zoetropeSvc"],angular.module("zoetropeControllers").controller("allProjectListCtrl",AllProjectListController),AllProjectListController.$inject=["$document","$location","projectSvc","systemInfoSvc"],angular.module("zoetropeControllers").controller("attachProjectCtrl",AttachProjectController),AttachProjectController.$inject=["$location","projectSvc","md5Svc"];var upArrow="&#x25B2;",downArrow="&#x25BC;",get_project_name=function(a,b){for(var c in b){var d=b[c];if(d.master_url==a.project_url)return""===d.project_name?a.project_url:d.project_name}return a.project_url},get_time_so_far=function(a){return a.ready_to_report?a.final_cpu_time:a.current_cpu_time},get_state_string=function(a){if(a.suspended_via_gui)return"Task suspended by user";if(2===a.state&&(1===a.scheduler_state||0===a.active_task_state))return"Waiting to run";switch(a.state){case 2:return"Running";case 3:return"Computation error";case 4:return"Uploading";case 5:return"Ready to report";case 6:return"Aborted by user";default:return a.state}};angular.module("zoetropeControllers").controller("DailyTransferCtrl",DailyTransferController),DailyTransferController.$inject=["systemInfoSvc"],angular.module("zoetropeControllers").controller("detachProjectCtrl",DetachProjectController),DetachProjectController.$inject=["projectSvc","$document","$location"],angular.module("zoetropeControllers").controller("DiskUsageCtrl",DiskUsageController),DiskUsageController.$inject=["systemInfoSvc"],angular.module("zoetropeControllers").controller("globalPreferencesCtrl",GlobalPreferencesCtrl),GlobalPreferencesCtrl.$inject=["systemInfoSvc"],angular.module("zoetropeControllers").controller("HostInfoCtrl",HostInfoController),HostInfoController.$inject=["systemInfoSvc"],angular.module("zoetropeControllers").controller("indexCtrl",IndexController),IndexController.$inject=["$scope","zoetropeSvc"],angular.module("zoetropeControllers").controller("loginCtrl",LoginController),LoginController.$inject=["userSvc"],angular.module("zoetropeControllers").controller("manageUsersCtrl",ManageUsersController),ManageUsersController.$inject=["userSvc"],angular.module("zoetropeControllers").controller("MessagesCtrl",MessagesController),MessagesController.$inject=["systemInfoSvc"],angular.module("zoetropeControllers").controller("miscConfigCtrl",MiscConfigController),MiscConfigController.$inject=["messagesSvc","endpointSvc"],angular.module("zoetropeControllers").controller("NoticesCtrl",NoticesController),NoticesController.$inject=["systemInfoSvc"],angular.module("zoetropeControllers").controller("ProjectCtrl",ProjectController),ProjectController.$inject=["$routeParams","$compile","$scope","$document","$location","projectSvc"],angular.module("zoetropeControllers").controller("projectDetailCtrl",ProjectDetailController),ProjectDetailController.$inject=["$routeParams","$document","$location","projectSvc","systemInfoSvc"],angular.module("zoetropeControllers").controller("ProjectsCtrl",ProjectsController),ProjectsController.$inject=["projectSvc","$document","$location"],angular.module("zoetropeControllers").controller("TaskCtrl",TaskController),TaskController.$inject=["$routeParams","$document","$location","taskSvc","projectSvc"],angular.module("zoetropeControllers").controller("tasksCtrl",TasksController),TasksController.$inject=["$document","$location","$log","$rootScope","taskSvc","projectSvc"];
//# sourceMappingURL=controller.js.map