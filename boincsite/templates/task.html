{% extends 'master.html' %}

{% block javascript %}

  function confirmAbort() {
    $('div.confirm-row').removeClass('hide');
  }

  $(function() {
    $('a.abort-button').on('click', function() { confirmAbort(); });
  })

{% endblock %}

{% block content %}
  {% raw %}
<div ng-controller="TaskCtrl">
  <div ng-show="!ready" class="text-center">
    <img src="/static/img/loading.gif" />
  </div>
  <div ng-show="ready && error" class="text-center">
    <span ng-bind="errorMessage"></span>
  </div>
  <div ng-show="ready && !error">
    <keyvalrow key="Project name" val="{{ task.project_name }}"></keyvalrow>
    <keyvalrow key="Percent done" val="{{ task.fraction_done + '%' }}"></keyvalrow>
    <keyvalrow key="Time Elapsed" val="{{ task.time_so_far }}"></keyvalrow>
    <keyvalrow key="Time Remaining" val="{{ task.estimated_cpu_time_remaining }}"></keyvalrow>
    <keyvalrow key="Report Deadline" val="{{ task.report_deadline }}"></keyvalrow>
    <keyvalrow key="Ready to report?" val="{{ task.ready_to_report }}"></keyvalrow>
    <keyvalrow key="State" val="{{ task.state }}"></keyvalrow>
    <keyvalrow key="Suspended via gui?" val="{{ task.suspended_via_gui }}"></keyvalrow>
    <keyvalrow key="Active task state" val="{{ task.active_task_state }}"></keyvalrow>

    <div class="row task-controls">
      <div class="col-xs-3"></div>
      <div class="col-xs-3">
        <a class="btn btn-primary pull-right"
          href="suspend_resume?task_name={{ task.name }}&return_url=/task?task_name={{ task.name }}">
          {{ suspend_button_text}}
        </a>
      </div>
      <div class="col-xs-3"><a class="btn btn-danger abort-button">Abort</a></div>
      <div class="col-xs-3"></div>
    </div>

    <div class="row confirm-row hide">
      <div class="col-xs-3"></div>
      <div class="col-xs-3"></div>
      <div class="col-xs-3">Confirm task abort: <a href="/abort_task?task_name={{ task.name }}">OK</a></div>
      <div class="col-xs-3"></div>
    </div>
    {% endraw %}
  </div>
  <div class="row home-row text-center">
    <a href="/">Home</a></div>    
  </div>
</div>
{% endblock %}
